/*! Lock stock and auth - v1.0.0 - 2017-04-24 */ 
/*! 
 * http://www.codehq.co.za 
 * Copyright 2017 Lock Stock and Auth Authors 
 * Copyright 2017 Code HQ (Pty) (Ltd) 
 Licensed under MIT (https://github.com/Halceyon/lock-stock-and-auth/blob/master/LICENSE) 
 */!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):a.aspnetAuth=b(a.jQuery)}(this,function(a){function b(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+1e3*c),d="; expires="+e.toGMTString()}else d="";document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"}function c(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null}function d(a){b(a,"",-1)}function e(a){b("aspnetAuthToken",a.access_token),b("apnetAuth",JSON.stringify(a))}function f(){var a=Date.parse(g.authentication[".expires"]),b=Date.parse(new Date);a<b?d("apnetAuth"):g.authentication=JSON.parse(c("apnetAuth"))}void 0===a&&alert("aspnet authentication requires jQuery");var g={authentication:null,user:{},url:"",register:function(a,b,c){$.ajax({method:"POST",url:this.url+"/api/account/register",data:{Username:a,Password:b,ConfirmPassword:b}}).done(function(a){c({result:"success",message:a})}).error(function(a){c({result:"failed",message:a.responseText})})},login:function(a,b,c){$.ajax({url:this.url+"/token",method:"POST",data:{username:a,password:b,grant_type:"password",client_id:"jsApp"},success:function(a){e(a),f(),c({result:"success",message:"User logged in successfully"})},error:function(a){c({result:"failed",message:a.responseJSON.error_description})}})},logout:function(a){d("aspnetAuthToken"),d("apnetAuth"),a({result:"success",message:"User logged out successfully"})},refreshToken:function(a){({grant_type:"refresh_token",refresh_token:this.authentication.refresh_token,client_id:"jsApp"});$.ajax({url:this.url+"/token",method:"POST",data:{grant_type:"refresh_token",refresh_token:this.authentication.refresh_token,client_id:"jsApp"},success:function(b){e(b),f(),a({result:"success",message:"Token refreshed"})},error:function(b){a({result:"failed",message:b.responseJSON.error_description})}})},fillAuth:function(){f()},web:{get:function(a,b,d){$.ajax({url:g.url+a,data:b,headers:{Authorization:"Bearer "+c("aspnetAuthToken")},method:"GET",success:function(a){d(a)},error:function(a){d(a)}})}}};return f(),g});